<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="xmap">
<title>Making Valid Crossmaps • xmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Making Valid Crossmaps">
<meta property="og:description" content="xmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9010</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/xmap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/making-xmaps.html">Making Valid Crossmaps</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Making Valid Crossmaps</h1>
            
      
      
      <div class="d-none name"><code>making-xmaps.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="nomenclature-crossmaps">Nomenclature Crossmaps<a class="anchor" aria-label="anchor" href="#nomenclature-crossmaps"></a>
</h2>
<p>A (Nomenclature) Crossmap encodes a complete redistribution of values
between a source and target classifications as a directed, bipartite,
weighted graph. Numeric values transformed using a valid Crossmap will
sum to the same total in both the source and target classifications. A
valid Crossmap satisfies the following conditions:</p>
<ol style="list-style-type: decimal">
<li>There is at most one link between each distinct source and target
node</li>
<li>For each source node, the sum of weights attached to outgoing links
sums to one.</li>
</ol>
<p>The outgoing and incoming properties of the graph links determine the
type of data transformation encoded by a given crossmap.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Recode</strong>: Maps with only one-to-one relations recode
category labels, leaving any attached values untouched</li>
<li>
<strong>Collapse</strong>: Maps with at least one set of
many-to-one/one-from-many links (i.e. multiple source categories
collapsed into a single target category) involve some kind of
aggregation of source values.</li>
<li>
<strong>Split</strong>: Maps with at least one set of one-to-many
links (i.e. a single source category split into multiple target
categories) involve redistribution of source values.</li>
</ol>
<div class="section level3">
<h3 id="crossmap-tables-xmap_df">Crossmap tables: <code>xmap_df</code><a class="anchor" aria-label="anchor" href="#crossmap-tables-xmap_df"></a>
</h3>
<p>An <code>xmap_df</code> is a data.frame representation of a Crossmap,
where each row represents a weighted link between the source and target
classifications. You can create an <code>xmap_df</code> from a
data.frame or tibble of weighted edges using
<code><a href="../reference/as_xmap_df.html">as_xmap_df()</a></code>.</p>
<p>Your input table <code>x</code> needs to have at least 3 complete
(i.e. no <code>NA</code>) columns:</p>
<ul>
<li>
<code>from</code>: source classification labels.</li>
<li>
<code>to</code>: target classification labels</li>
<li>
<code>weights</code>: applied to values in the source
classification</li>
</ul>
<p>Additional columns (e.g. for label descriptions etc.) can be retained
using the <code>.keep_all</code> argument.</p>
<p><code><a href="../reference/as_xmap_df.html">as_xmap_df()</a></code> will validate that for <code>x</code>:</p>
<ol style="list-style-type: decimal">
<li>There are no duplicates <code>from</code>-<code>to</code>
pairs,</li>
<li>Every group of <code>weights</code> associated with a distinct
<code>from</code> value sums to 1 (subject to minor floating point
errors).</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="creating-crossmaps-tables">Creating Crossmaps Tables<a class="anchor" aria-label="anchor" href="#creating-crossmaps-tables"></a>
</h2>
<div class="section level3">
<h3 id="row-wise-creation">Row-wise creation<a class="anchor" aria-label="anchor" href="#row-wise-creation"></a>
</h3>
<p>The following example shows how to encode one-to-one, many-to-one and
one-to-many links and coerce them into a <code>xmap_df</code>. This
method is most suitable for simple crossmaps.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">xmap</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">source</span>, <span class="op">~</span><span class="va">target</span>, <span class="op">~</span><span class="va">share</span>,</span>
<span>  <span class="st">"equal"</span>, <span class="st">"EQUAL"</span>, <span class="fl">1</span>,       <span class="co"># one-to-one</span></span>
<span>  <span class="st">"member_1"</span>, <span class="st">"GROUP"</span>, <span class="fl">1</span>,    <span class="co"># many-to-one</span></span>
<span>  <span class="st">"member_2"</span>, <span class="st">"GROUP"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"whole"</span>, <span class="st">"PART_1"</span>, <span class="fl">0.3</span>,    <span class="co"># one-to-many</span></span>
<span>  <span class="st">"whole"</span>, <span class="st">"PART_2"</span>, <span class="fl">0.6</span>,</span>
<span>  <span class="st">"whole"</span>, <span class="st">"PART_3"</span>, <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_xmap</span> <span class="op">&lt;-</span> <span class="va">simple_x</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">source</span>, to <span class="op">=</span> <span class="va">target</span>, weights <span class="op">=</span> <span class="va">share</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_xmap</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode, split, and collapse  </span></span>
<span><span class="co">## (source -&gt; target) BY share</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">##   source   target share</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> equal    EQUAL    1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> member_1 GROUP    1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> member_2 GROUP    1  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> whole    PART_1   0.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> whole    PART_2   0.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> whole    PART_3   0.1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="coercion-from-crosswalks">Coercion from Crosswalks<a class="anchor" aria-label="anchor" href="#coercion-from-crosswalks"></a>
</h3>
<p>It is more common that you will want to convert an existing
correspondence into a crossmap. Such conversions require attaching
appropriate weights to the existing crosswalk table.</p>
<div class="section level4">
<h4 id="recode-maps">Recode maps<a class="anchor" aria-label="anchor" href="#recode-maps"></a>
</h4>
<p>Consider the first five country codes in the ISO 3166 international
standard and the one-to-one correspondence between the 2-digit, 2-digit
and numeric codes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iso_codes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>              <span class="op">~</span><span class="va">country</span>, <span class="op">~</span><span class="va">ISO2</span>, <span class="op">~</span><span class="va">ISO3</span>, <span class="op">~</span><span class="va">ISONumeric</span>,</span>
<span>         <span class="st">"Afghanistan"</span>,          <span class="st">"AF"</span>,         <span class="st">"AFG"</span>,    <span class="st">"004"</span>,</span>
<span>             <span class="st">"Albania"</span>,          <span class="st">"AL"</span>,         <span class="st">"ALB"</span>,    <span class="st">"008"</span>,</span>
<span>             <span class="st">"Algeria"</span>,          <span class="st">"DZ"</span>,         <span class="st">"DZA"</span>,    <span class="st">"012"</span>,</span>
<span>      <span class="st">"American Samoa"</span>,          <span class="st">"AS"</span>,         <span class="st">"ASM"</span>,    <span class="st">"016"</span>,</span>
<span>             <span class="st">"Andorra"</span>,          <span class="st">"AD"</span>,         <span class="st">"AND"</span>,    <span class="st">"020"</span></span>
<span>      <span class="op">)</span></span></code></pre></div>
<p>To create a crossmap between <code>ISONumeric</code> and
<code>ISO2</code>, we simply add a weights columns and coerce to
<code>xmap_df</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iso_xmap</span> <span class="op">&lt;-</span> <span class="va">iso_codes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>link <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ISONumeric</span>, to <span class="op">=</span> <span class="va">ISO2</span>, weights <span class="op">=</span> <span class="va">link</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Notice that <code><a href="../reference/as_xmap_df.html">as_xmap_df()</a></code> place the <code>from</code>,
<code>to</code> and <code>weights</code> columns first.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iso_xmap</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode </span></span>
<span><span class="co">## (ISONumeric -&gt; ISO2) BY link</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   ISONumeric ISO2   link country        ISO3 </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 004        AF        1 Afghanistan    AFG  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 008        AL        1 Albania        ALB  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 012        DZ        1 Algeria        DZA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 016        AS        1 American Samoa ASM  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 020        AD        1 Andorra        AND</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="collapse-maps-aggregation">Collapse maps: Aggregation<a class="anchor" aria-label="anchor" href="#collapse-maps-aggregation"></a>
</h4>
<p>Now consider aggregating data which were collected using the ISO
3166-2 Subdivisions of <a href="https://en.wikipedia.org/w/index.php?title=ISO_3166-2:AU&amp;oldid=1110907059" class="external-link">Australia</a>
and <a href="https://en.wikipedia.org/w/index.php?title=ISO_3166-2:CA&amp;oldid=1110906706" class="external-link">Canada</a>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adm1_list</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">ctr</span>, <span class="op">~</span><span class="va">adm1</span>,</span>
<span>  <span class="st">"AU"</span>, <span class="st">"AU-NSW, AU-QLD, AU-SA, AU-TAS, AU-VIC, AU-WA, AU-ACT, AU-NT"</span>,</span>
<span>  <span class="st">"CA"</span>, <span class="st">"CA-AB, CA-BC, CA-MB, CA-NB, CA-NL, CA-NS, CA-ON, CA-PE, CA-QC, CA-SK, CA-NT, CA-NU, CA-YT"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Recall that we need one row per relation between the source
(<code>adm1</code>) and target (<code>ctr</code>) nomenclature. Thus we
split the string list into a vector, and then unnest the values by
country.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_x</span> <span class="op">&lt;-</span> <span class="va">adm1_list</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>adm1 <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">adm1</span>, <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agg_x</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 21 × 2</span></span></span>
<span><span class="co">##    ctr   adm1  </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> AU    AU-NSW</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> AU    AU-QLD</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> AU    AU-SA </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> AU    AU-TAS</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> AU    AU-VIC</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> AU    AU-WA </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> AU    AU-ACT</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> AU    AU-NT </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> CA    CA-AB </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> CA    CA-BC </span></span>
<span><span class="co">## <span style="color: #949494;"># … with 11 more rows</span></span></span></code></pre>
<p>Since aggregation involves the one-to-one transfer of values between
<code>adm1</code> and <code>ctr</code> prior to the collapsing the
<code>ctr</code> groups, we simple add weights of one to form a valid
crossmap:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_xmap</span> <span class="op">&lt;-</span> <span class="va">agg_x</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>link <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">adm1</span>, to <span class="op">=</span> <span class="va">ctr</span>, weights <span class="op">=</span> <span class="va">link</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; xmap_df:</span></span>
<span><span class="co">#&gt; recode and collapse</span></span>
<span><span class="co">#&gt; (adm1 -&gt; ctr) BY link</span></span>
<span><span class="co">#&gt; # A tibble: 21 × 3</span></span>
<span><span class="co">#&gt;    adm1   ctr    link</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 AU-NSW AU        1</span></span>
<span><span class="co">#&gt;  2 AU-QLD AU        1</span></span>
<span><span class="co">#&gt;  3 AU-SA  AU        1</span></span>
<span><span class="co">#&gt;  4 AU-TAS AU        1</span></span>
<span><span class="co">#&gt;  5 AU-VIC AU        1</span></span>
<span><span class="co">#&gt;  6 AU-WA  AU        1</span></span>
<span><span class="co">#&gt;  7 AU-ACT AU        1</span></span>
<span><span class="co">#&gt;  8 AU-NT  AU        1</span></span>
<span><span class="co">#&gt;  9 CA-AB  CA        1</span></span>
<span><span class="co">#&gt; 10 CA-BC  CA        1</span></span>
<span><span class="co">#&gt; # … with 11 more rows</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="split-maps-disaggregation">Split maps: Disaggregation<a class="anchor" aria-label="anchor" href="#split-maps-disaggregation"></a>
</h4>
<p>Conversely, we might have aggregate level data which want to
disaggregate. Continuing the above example, this could involve
incorporating country level data into analysis at the 3166-2
Subdivisions level.</p>
<p>For example, imagine that we have population figures for Australia at
the 3166-2 level for 9 out of 10 years, but only country level figures
for the missing year. In this simple example, a reasonable harmonisation
design could involve splitting the country level figure by the
subdivision level population proportions from the year preceding or
following the missing year.</p>
<p>Alternatively, we might want to compare aggregate and disaggregate
statistics to identify discrepancies.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>                              <span class="op">~</span><span class="va">state</span>,    <span class="op">~</span><span class="va">adm1</span>,    <span class="op">~</span><span class="va">Pop</span>,</span>
<span>                   <span class="st">"New South Wales"</span>, <span class="st">"AU-NSW"</span>, <span class="fl">8153600</span>,</span>
<span>                          <span class="st">"Victoria"</span>, <span class="st">"AU-VIC"</span>, <span class="fl">6613700</span>,</span>
<span>                        <span class="st">"Queensland"</span>, <span class="st">"AU-QLD"</span>, <span class="fl">5322100</span>,</span>
<span>                   <span class="st">"South Australia"</span>,  <span class="st">"AU-SA"</span>, <span class="fl">1820500</span>,</span>
<span>                 <span class="st">"Western Australia"</span>,  <span class="st">"AU-WA"</span>, <span class="fl">2785300</span>,</span>
<span>                          <span class="st">"Tasmania"</span>, <span class="st">"AU-TAS"</span>,  <span class="fl">571500</span>,</span>
<span>                <span class="st">"Northern Territory"</span>,  <span class="st">"AU-NT"</span>,  <span class="fl">250600</span>,</span>
<span>      <span class="st">"Australian Capital Territory"</span>, <span class="st">"AU-ACT"</span>,  <span class="fl">456700</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">state_xmap</span> <span class="op">&lt;-</span> <span class="va">state_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ctr <span class="op">=</span> <span class="st">"AU"</span>,</span>
<span>                <span class="va">adm1</span>,</span>
<span>                share <span class="op">=</span> <span class="va">Pop</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Pop</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ctr</span>, to <span class="op">=</span> <span class="va">adm1</span>, weights <span class="op">=</span> <span class="va">share</span>, .keep_all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Dropped additional columns in `x`</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&gt; xmap_df:</span></span>
<span><span class="co">#&gt; split</span></span>
<span><span class="co">#&gt; (ctr -&gt; adm1) BY share</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span><span class="co">#&gt;   ctr   adm1     share</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 AU    AU-NSW 0.314</span></span>
<span><span class="co">#&gt; 2 AU    AU-VIC 0.255</span></span>
<span><span class="co">#&gt; 3 AU    AU-QLD 0.205</span></span>
<span><span class="co">#&gt; 4 AU    AU-SA  0.0701</span></span>
<span><span class="co">#&gt; 5 AU    AU-WA  0.107</span></span>
<span><span class="co">#&gt; 6 AU    AU-TAS 0.0220</span></span>
<span><span class="co">#&gt; 7 AU    AU-NT  0.00965</span></span>
<span><span class="co">#&gt; 8 AU    AU-ACT 0.0176</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mixed-maps">Mixed Maps<a class="anchor" aria-label="anchor" href="#mixed-maps"></a>
</h3>
<p>Now consider the following mixed transformation using selected
correspondences between NAICS Canada 1997 and ISIC Revision 3. Imagine
that we have some numeric data (e.g. gross output in CAD) collected in
the NAICS Canada nomenclature that we want to harmonise into ISIC
Revision 3. The correspondence between the two nomenclature contains a
mixture of one-to-one, one-to-many, many-to-one and many-to-many
relations.</p>
<p>Luckily, we only need to deal with two cases when forming a
crossmap:</p>
<ol style="list-style-type: decimal">
<li>links with unit weights (recode and collapse) and,</li>
<li>links with fractional weights (split).</li>
</ol>
<p>Let’s first define some example correspondences.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;based on examples provided by Statistics Canada on the
page &lt;a href="https://www.statcan.gc.ca/en/subjects/standard/concordances/concordanc_tabl3" class="external-link"&gt;How
to Read a Concordance Table&lt;/a&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
<p>In the first example, one NAICS Canada class relates to exactly one
ISIC class.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_recode</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  NAICS1997      <span class="op">=</span> <span class="st">"212210"</span>, </span>
<span>  NAICS1997_desc <span class="op">=</span> <span class="st">"Iron Ore Mining"</span>,</span>
<span>  ISIC3          <span class="op">=</span> <span class="st">"C1310"</span>,</span>
<span>  ISIC3_desc    <span class="op">=</span> <span class="st">"Mining of iron ores"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   NAICS1997 NAICS1997_desc  ISIC3 ISIC3_desc         </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 212210    Iron Ore Mining C1310 Mining of iron ores</span></span></code></pre>
<p>In the second example, one ISIC class is equivalent to more than one
NAICS Canada class. The asterisk (Partial Flag) indicates that part of
ISIC D1543 is equivalent to each NAICS Canada class. The ISIC activities
corresponding to each NAICS Canada class are listed in the column
labelled “Link”.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_agg</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">NAICS1997</span>, <span class="op">~</span><span class="va">NAICS1997_desc</span>, <span class="op">~</span><span class="va">ISIC3</span>, <span class="op">~</span><span class="va">ISIC3_desc</span>, <span class="op">~</span><span class="va">Link</span>,</span>
<span>  <span class="st">"311320"</span>, <span class="st">"Chocolate and Confectionery Manufacturing from Cacao Beans"</span>, <span class="st">"D1543 *"</span>, <span class="st">"Manufacture of cocoa, chocolate and sugar confectionery"</span>, <span class="st">"Chocolate and confectionery, made from cacao beans"</span>,</span>
<span>  <span class="st">"311330"</span>, <span class="st">"Confectionery Manufacturing from Purchased Chocolate"</span>, <span class="st">"D1543 *"</span>, <span class="st">"Manufacture of cocoa, chocolate and sugar confectionery"</span>, <span class="st">"Confectionery, made from purchased chocolate"</span>,</span>
<span>  <span class="st">"311340"</span>, <span class="st">"Non-Chocolate Confectionery Manufacturing"</span>, <span class="st">"D1543 *"</span>, <span class="st">"Manufacture of cocoa, chocolate and sugar confectionery"</span>, <span class="st">"Non-chocolate confectionery, manufacturing"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   NAICS1997 NAICS1997_desc                                   ISIC3 ISIC3…¹ Link </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 311320    Chocolate and Confectionery Manufacturing from … D154… Manufa… Choc…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 311330    Confectionery Manufacturing from Purchased Choc… D154… Manufa… Conf…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 311340    Non-Chocolate Confectionery Manufacturing        D154… Manufa… Non-…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable name ¹​ISIC3_desc</span></span></span></code></pre>
<p>In this third example, one NAICS Canada class is equivalent to more
than one ISIC class.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_split</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">NAICS1997</span>, <span class="op">~</span><span class="va">NAICS1997_desc</span>, <span class="op">~</span><span class="va">ISIC3</span>, <span class="op">~</span><span class="va">ISIC3_desc</span>, <span class="op">~</span><span class="va">Link</span>,</span>
<span>  <span class="st">"483213"</span>, <span class="st">"Inland Water Transportation (except by Ferries)"</span>, <span class="st">"I6110 *"</span>, <span class="st">"Sea and coastal water transport"</span>, <span class="st">"Intracoastal water transportation"</span>,</span>
<span>  <span class="st">"483213"</span>, <span class="st">"Inland Water Transportation (except by Ferries)"</span>, <span class="st">"I6120 *"</span>, <span class="st">"Inland water transport"</span>, <span class="st">"Inland water transportation (except ferries)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   NAICS1997 NAICS1997_desc                                  ISIC3  ISIC3…¹ Link </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 483213    Inland Water Transportation (except by Ferries) I6110… Sea an… Intr…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 483213    Inland Water Transportation (except by Ferries) I6120… Inland… Inla…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable name ¹​ISIC3_desc</span></span></span></code></pre>
<div class="section level4">
<h4 id="unit-weight-links">Unit weight links<a class="anchor" aria-label="anchor" href="#unit-weight-links"></a>
</h4>
<p>Notice that for both recode and collapse category relations, values
attached to each source category are not directly modified during the
“transfer” between source and target nomenclature. Instead, the source
values are either retained, or summarised when the category collapse
(and value aggregation) is performed. Thus, as shown above, both recode
and collapse links have a weight of one.</p>
<p>Let’s clean up the recode and collapse links defined above:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_unit</span> <span class="op">&lt;-</span> <span class="va">canada_agg</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove the partial flag (*)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ISIC3 <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">ISIC3</span>, <span class="st">" \\*"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Link</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># bind the links together and add weights</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">canada_recode</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">canada_unit</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">##   NAICS1997 NAICS1997_desc                                   ISIC3 ISIC3…¹ share</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 311320    Chocolate and Confectionery Manufacturing from … D1543 Manufa…     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 311330    Confectionery Manufacturing from Purchased Choc… D1543 Manufa…     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 311340    Non-Chocolate Confectionery Manufacturing        D1543 Manufa…     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 212210    Iron Ore Mining                                  C1310 Mining…     1</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable name ¹​ISIC3_desc</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="fractional-weight-links">Fractional weight links<a class="anchor" aria-label="anchor" href="#fractional-weight-links"></a>
</h4>
<p>Now all that remains is to prepare the split links. Similar to the
disaggregation example above, we need to design weights to allocate the
“pool” of numeric value associated with the NAICS class
<code>483213</code> into the corresponding ISIC classes
<code>I6110</code> and <code>I6120</code>.</p>
<p>Assume for illustration purposes that the Canadian “Inland water
transport” industry (<code>I6120</code>) is twice as big as the “Sea and
coastal water transport” industry (<code>I6110</code>). This suggests
that the weight between <code>483213</code> and <code>I6120</code>
should be twice that of <code>I6110</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_frac</span> <span class="op">&lt;-</span> <span class="va">canada_split</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ISIC3 <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">ISIC3</span>, <span class="st">" \\*"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Link</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">ISIC3</span> <span class="op">==</span> <span class="st">"I6110"</span> <span class="op">~</span> <span class="fl">0.33</span>,</span>
<span>                                  <span class="va">ISIC3</span> <span class="op">==</span> <span class="st">"I6120"</span> <span class="op">~</span> <span class="fl">0.67</span>,</span>
<span>                                  <span class="cn">T</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s combine the unit and fractional links into a crossmap:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">canada_xmap</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">canada_unit</span>, <span class="va">canada_frac</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">NAICS1997</span>, to <span class="op">=</span> <span class="va">ISIC3</span>, weights <span class="op">=</span> <span class="va">share</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">canada_xmap</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode, split, and collapse  </span></span>
<span><span class="co">## (NAICS1997 -&gt; ISIC3) BY share</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##   NAICS1997 ISIC3 share NAICS1997_desc                                   ISIC3…¹</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 311320    D1543  1    Chocolate and Confectionery Manufacturing from … Manufa…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 311330    D1543  1    Confectionery Manufacturing from Purchased Choc… Manufa…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 311340    D1543  1    Non-Chocolate Confectionery Manufacturing        Manufa…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 212210    C1310  1    Iron Ore Mining                                  Mining…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 483213    I6110  0.33 Inland Water Transportation (except by Ferries)  Sea an…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 483213    I6120  0.67 Inland Water Transportation (except by Ferries)  Inland…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable name ¹​ISIC3_desc</span></span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="one-way-crossmaps">One-Way Crossmaps<a class="anchor" aria-label="anchor" href="#one-way-crossmaps"></a>
</h2>
<p>Except in the case of recoding, crossmaps are generally lateral
(one-way). Weights on collapse and split links are no longer valid if
you reverse the direct of the link. Notice that
<code><a href="../reference/as_xmap_df.html">as_xmap_df()</a></code> throws an error if you try to naively swap the
<code>from</code> and <code>to</code> arguments:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">canada_unit</span>, <span class="va">canada_frac</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ISIC3</span>, to <span class="op">=</span> <span class="va">NAICS1997</span>, weights <span class="op">=</span> <span class="va">share</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `df_check_weights()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Incomplete mapping weights found. Check sum of weights for each `from`</span></span>
<span><span class="co">##   group sums to 1</span></span></code></pre>
<p>However, we <strong>can</strong> swap the arguments on a recode map.
Recall the ISO country code crossmap we created above:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iso_xmap</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode </span></span>
<span><span class="co">## (ISONumeric -&gt; ISO2) BY link</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   ISONumeric ISO2   link country        ISO3 </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 004        AF        1 Afghanistan    AFG  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 008        AL        1 Albania        ALB  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 012        DZ        1 Algeria        DZA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 016        AS        1 American Samoa ASM  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 020        AD        1 Andorra        AND</span></span></code></pre>
<p>Imagine that instead of converting country codes from ISO Numeric to
ISO-2 digit, we wanted to convert from ISO-2 digit to ISO Numeric. We
can take the existing crossmap and invert it without editing any
weights:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iso_xmap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ISO2</span>, to <span class="op">=</span> <span class="va">ISONumeric</span>, weights <span class="op">=</span> <span class="va">link</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode </span></span>
<span><span class="co">## (ISO2 -&gt; ISONumeric) BY link</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   ISO2  ISONumeric  link country        ISO3 </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AF    004            1 Afghanistan    AFG  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AL    008            1 Albania        ALB  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> DZ    012            1 Algeria        DZA  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> AS    016            1 American Samoa ASM  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> AD    020            1 Andorra        AND</span></span></code></pre>
<p>We can also easily generate crossmaps for the other nomenclature in
the table:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iso_xmap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ISO2</span>, to <span class="op">=</span> <span class="va">ISO3</span>, weights <span class="op">=</span> <span class="va">link</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## xmap_df:</span></span>
<span><span class="co">## recode </span></span>
<span><span class="co">## (ISO2 -&gt; ISO3) BY link</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   ISO2  ISO3   link ISONumeric country       </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AF    AFG       1 004        Afghanistan   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AL    ALB       1 008        Albania       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> DZ    DZA       1 012        Algeria       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> AS    ASM       1 016        American Samoa</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> AD    AND       1 020        Andorra</span></span></code></pre>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Cynthia Huang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
