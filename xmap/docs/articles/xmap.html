<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="xmap">
<title>Getting Started with Crossmaps • xmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with Crossmaps">
<meta property="og:description" content="xmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9019</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/xmap.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/making-xmaps.html">Making and Verifying Crossmaps</a>
    <a class="dropdown-item" href="../articles/vis-xmaps.html">Visualising Crossmap Transformations</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cynthiahqy/xmap">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started with Crossmaps</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cynthiahqy/conformr-xmap-project/tree/main/xmapvignettes/xmap.Rmd" class="external-link"><code>vignettes/xmap.Rmd</code></a></small>
      <div class="d-none name"><code>xmap.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="checking-existing-pipelines">Checking existing pipelines<a class="anchor" aria-label="anchor" href="#checking-existing-pipelines"></a>
</h2>
<p><code>xmap</code> offers verification functions for mappings encoded
in named vectors or lists as well as data frames. Many of these checks
will seem trivial in short mappings, but can be useful checks for longer
or more complex mappings.</p>
<p>For example, if you are using a named list to manually recode
categorical variables (e.g. using <code><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">forcats::fct_recode</a></code>),
then you might want to verify some properties of the level mappings –
e.g. each existing level is only mapped once:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">xmap</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"bear"</span>, <span class="st">"banana"</span>, <span class="st">"dear"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">levels</span> <span class="op">&lt;-</span> <span class="co">## new = "old" levels</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>fruit <span class="op">=</span> <span class="st">"apple"</span>, fruit <span class="op">=</span> <span class="st">"banana"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/verify_named.html">verify_named_all_values_unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">levels</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] fruit bear  fruit dear </span></span>
<span><span class="co">## Levels: fruit bear dear</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mistake_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>fruit <span class="op">=</span> <span class="st">"apple"</span>, fruit <span class="op">=</span> <span class="st">"banana"</span>, veg <span class="op">=</span> <span class="st">"banana"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/verify_named.html">verify_named_all_values_unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `verify_named_all_values_unique()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> Duplicated values found in `x`. Use</span></span>
<span><span class="co">##   `base::duplicated(unlist(unname(x)))` to identify duplicates.</span></span></code></pre>
<p>Similarly, if you are using a named list to encode group members, you
could check the members against a reference list.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## mistakenly assign kate to another group</span></span>
<span><span class="va">student_group_mistake</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GRP1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kate"</span>, <span class="st">"jane"</span>, <span class="st">"peter"</span><span class="op">)</span>,</span>
<span>                           GRP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"terry"</span>, <span class="st">"ben"</span>, <span class="st">"grace"</span><span class="op">)</span>,</span>
<span>                           GRP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cindy"</span>, <span class="st">"lucy"</span>, <span class="st">"kate"</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">student_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kate"</span>, <span class="st">"jane"</span>, <span class="st">"peter"</span>, <span class="st">"terry"</span>, <span class="st">"ben"</span>, </span>
<span>                  <span class="st">"grace"</span>, <span class="st">"cindy"</span>, <span class="st">"lucy"</span>, <span class="st">"alex"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">student_group_mistake</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">verify_named_matchset_values_exact</span><span class="op">(</span><span class="va">student_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_named_matchset()`:</span></span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> The values of `x` do not exactly match `ref_set`</span></span></code></pre>
<p>If you are redistributing numeric values between categories, see
<code><a href="../articles/making-xmaps.html">vignette("making-xmaps")</a></code> for details on how to check your
transformation weights redistribute exactly 100% of your original
data.</p>
</div>
<div class="section level2">
<h2 id="creating-an-xmap-object">Creating an <code>xmap</code> object<a class="anchor" aria-label="anchor" href="#creating-an-xmap-object"></a>
</h2>
<p>If you already have a data frame of candidate links, turn them into a
valid <code>xmap</code> object by specifying the source
(<code>from</code>) nodes, target (<code>to</code>) nodes, and weights
(<code>weights</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">links</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">ISIC2</span>, to <span class="op">=</span> <span class="va">ISIC3</span>, weights <span class="op">=</span> <span class="va">shares</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-xmap-objects">Using <code>xmap</code> objects<a class="anchor" aria-label="anchor" href="#using-xmap-objects"></a>
</h2>
<p>All crossmaps transformations can be decomposed into multiple
“standard” data manipulation steps.</p>
<ol style="list-style-type: decimal">
<li><strong>Rename original categories into target
categories</strong></li>
<li><strong>Mutate source node values by link weight.</strong></li>
<li><strong>Summarise mutated values by target node.</strong></li>
</ol>
<p>To implement these steps, use <code>xmap_df</code> just like normal
tibbles or data.frames in a <code>dplyr</code> pipeline.</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join</a></code> the target categories
(<code>to</code>) to the original data via the source labels
(<code>from</code>).</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code> the source values by multiplying them
with the link weights (<code>weights</code>) to transform the original
values into redistributed values.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise</a></code>
values by target groups (<code>to</code>) to complete any many-to-1
mappings.</li>
</ol>
<p>For example given some original data (<code>v19_data</code>) with
source categories (<code>v19</code>), and a valid <code>xmap</code> with
source categories (<code>from = version19</code>), target categories
(<code>to = version18</code>) and link weights
(<code>weights = w19to18</code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">xmap</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># original data</span></span>
<span><span class="va">v19_data</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">v19</span>, <span class="op">~</span><span class="va">count</span>,</span>
<span>  <span class="st">"1120"</span>, <span class="fl">300</span>,</span>
<span>  <span class="st">"1121"</span>, <span class="fl">400</span>,</span>
<span>  <span class="st">"1130"</span>, <span class="fl">200</span>,</span>
<span>  <span class="st">"1200"</span>, <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># valid crossmap</span></span>
<span><span class="va">xmap_19to18</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">version19</span>, <span class="op">~</span><span class="va">version18</span>, <span class="op">~</span><span class="va">w19to18</span>,</span>
<span>  <span class="co"># many-to-1 collapsing</span></span>
<span>  <span class="st">"1120"</span>, <span class="st">"A2"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"1121"</span>, <span class="st">"A2"</span>, <span class="fl">1</span>,</span>
<span>  <span class="co"># 1-to-1 recoding</span></span>
<span>  <span class="st">"1130"</span>, <span class="st">"A3"</span>, <span class="fl">1</span>,</span>
<span>  <span class="co"># 1-to-many redistribution</span></span>
<span>  <span class="st">"1200"</span>, <span class="st">"A4"</span>, <span class="fl">0.6</span>,</span>
<span>  <span class="st">"1200"</span>, <span class="st">"A5"</span>, <span class="fl">0.4</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_xmap_df.html">as_xmap_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">version19</span>, to <span class="op">=</span> <span class="va">version18</span>, weights <span class="op">=</span> <span class="va">w19to18</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transformed data</span></span>
<span><span class="op">(</span><span class="va">v18_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">v19_data</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">xmap_19to18</span>,</span>
<span>                      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v19 <span class="op">=</span> <span class="st">"version19"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>new_count <span class="op">=</span> <span class="va">count</span> <span class="op">*</span> <span class="va">w19to18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">version18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>v20_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">new_count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in dplyr::left_join(x = v19_data, y = xmap_19to18, by = c(v19 = "version19")): Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Row 4 of `x` matches multiple rows.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class="co">##   warning.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##   version18 v20_count</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> A2              700</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> A3              200</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> A4              360</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> A5              240</span></span></code></pre>
<p>Note that we expect multiple matches for 1-to-many relations so the
<code>dplyr</code> warning can safely be ignored.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.cynthiahqy.com" class="external-link">Cynthia Huang</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
